{{ define "main" }}
<article class="flex-ns flex-column w-75-l ph2-l center f4 lh-copy gray">
  <section class="ph4 measure-wide center">
    <p class="mt0 mb3">
      <a href="/library/" class="link black-90">← My Shelf</a>
    </p>
    <div class="book-info-card mb4">
      <div class="flex items-start justify-between">
      {{ with .Params.featured_image }}
        <img src="{{ . }}" alt="{{ $.Title }} cover" style="width:160px;height:auto;border-radius:8px;margin-right:16px;box-shadow:0 2px 8px rgba(0,0,0,.08);" />
      {{ end }}
      <div class="flex-auto">
        <h1 class="f2 fw6 black ma0">{{ .Title }}</h1>
        <p class="mt2 mb1 f5 gray">
          {{ with .Params.book_author }}<span>by {{ . }}</span>{{ end }}
          {{ if and .Params.book_author (or .Params.book_category .Params.book_year) }} • {{ end }}
          {{ with .Params.book_category }}<span>{{ . }}</span>{{ end }}
          {{ if and .Params.book_category .Params.book_year }} • {{ end }}
          {{ with .Params.book_year }}<span>{{ . }}</span>{{ end }}
        </p>
      </div>
      {{ with .Params.amazon_link }}
        <div class="self-end">
          <a class="link black-90" target="_blank" href="{{ . }}">Get the book</a>
        </div>
      {{ end }}
      </div>
    </div>
    

    <div class="book-content">
      {{- $raw := .RawContent -}}
      {{- $clean := replaceRE "(?s)## About This Book.*?(?=\n## |\z)" "" $raw -}}
      {{ $clean | markdownify }}
    </div>

    <div class="mt4 pt3 bt b--light-gray">
      <a href="/library/" class="link black-90">← Back to Shelf</a>
    </div>
  </section>
</article>
{{ end }}

